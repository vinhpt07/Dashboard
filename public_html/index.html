<!DOCTYPE html>
<html>
    <head>
        <title>NexGen DashBoard</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <style>





text {
  font: bold 36px monospace;
}

.enter {
  fill: green;
}

.update {
  fill: #333;
}

.exit {
  fill: brown;
}






    </style>
    </head>

    <body>
        <svg width="1200" height="700">

        </svg>
    </body>
<script>
//var alphabet = "abcdefghijklmnopqrstuvwxyz".split("");
//
var data = [  
   {"percent" : 1,"color":"gray","opacity":"0.3","value":1000,"x":150,"y":100,"r":100},
   {"percent" : 0.2942,"color":"orange","opacity":"1","value":295,"x":150,"y":100,"r":100},
   {"percent" : 1,"color":"gray","opacity":"0.3","value":192,"x":550,"y":100,"r":100},
   {"percent" : 0.2942,"color":"orange","opacity":"1","value":56,"x":550,"y":100,"r":100},
   {"percent" : 1,"color":"gray","opacity":"0.3","value":32,"x":950,"y":100,"r":100},
   {"percent" : 0.2942,"color":"orange","opacity":"1","value":9,"x":950,"y":100,"r":100}
];
var image = [
    {"href":"img/typing.png","x":100,"y":50},
    {"href":"img/checking.png","x":500,"y":50},
    {"href":"img/users.png","x":900,"y":50}
];
var package = [
    {"volume":1000,"keyed":100},{"volume":1000,"keyed":800}

];

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height"),
    g = svg.append("g").attr("transform", "translate(32," + (height / 2) + ")");
    g2 = svg.append("g").attr("transform", "translate(32,0)");
    //<path id="arc1" fill="none" stroke="#446688" stroke-width="20" d="M 50 150 A 100 100 0 1 0 150 50"></path>
var   count = package.length,
      cx = width/2,
      cy = height/4,
      stdLen = count<=6 ? width/6:width/6,
      stdHei = 11;
var tooltip = d3.select("body")
	.append("div")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.text("a simple tooltip");         
    function drawCircle(x,y,radius,percent){
        var context = d3.path();
        context.arc(x,y,radius,percent*1.7*Math.PI,0.5*Math.PI,true);
        return context.toString();
    }
    function drawLine(x,y,dx,dy){
        var context = d3.path();
        context.moveTo(x,y);
        context.lineTo(dx,dy);
        return context.toString();
    }
    function update(){
      var t = g.transition()
      .duration(750)
      .on("start", function repeat() {
        d3.active(this).selectAll("path").filter(":nth-child(even)")
            .style("stroke", "purple")
          .transition()
            .style("stroke", "blue")
          .transition()
           .on("start", repeat) ;
      });

    //Circles added to the circleGroup
    var circles = g.selectAll("path")
                             .data(data);
                             
                             
    circles.transition(t)
           
             .attr("d",function(d){return drawCircle(d.x,d.y,d.r,d.percent);})
             
             .attr("stroke-width","1")
             .attr("fill","none")
             .attr("opacity",function(d){return d.opacity;})
             
             .attr("stroke",function(d){return d.color;})
             .attr("stroke-width","11");

    circles.enter().append("path")
                .attr("d",function(d){return drawCircle(d.x,d.y,d.r,d.percent);})
                
                .attr("stroke-width","1")
                .transition(t)
                .attr("fill","none")
                .attr("opacity",function(d){return d.opacity;})          
                .attr("stroke",function(d){return d.color;})
                .attr("stroke-width","11");
          
    var texts_even = g.selectAll("text").filter(":nth-child(even)")
            .data([data[1],data[3],data[5]]);
    var texts_odd = g.selectAll("text").filter(":nth-child(odd)")
            .data(data);
        texts_even
                .text(function(d){return d.value;})
                .attr("dx", function(d){return d.percent===1? d.x+0.8*d.r:d.x-20;})
                .attr("dy", function(d){return d.percent===1? d.y-d.r:d.y+1.8*d.r;})
                .attr("opacity",function(d){return d.opacity;})          
                .attr("stroke",function(d){return d.color;})
                .attr("fill",function(d){return d.color;});    
        g.selectAll("text").data(data).enter().append("text")
                .text(function(d){return d.value;})
                .attr("dx", function(d){return d.percent===1? d.x+0.8*d.r:d.x-20;})
                .attr("dy", function(d){return d.percent===1? d.y-d.r:d.y+1.8*d.r;})
                .attr("opacity",function(d){return d.opacity;})          
                .attr("stroke",function(d){return d.color;})
                .attr("fill",function(d){return d.color;});
     var imgs = g.selectAll("image").data(image);
                imgs.enter()
                .append("svg:image")
                .attr("xlink:href", function(d){return d.href;})
                .attr("x", function(d){return d.x;})
                .attr("y", function(d){return d.y;})
                .attr("width", "100")
                .attr("height", "100");
        ;
    }
    var getGradient = function(percent,i){
     gradient = svg.append("svg:defs")
    .append("svg:linearGradient")
    .attr("id", "gradient"+i)
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%")
    .attr("spreadMethod", "pad")
    ;

    gradient.append("svg:stop")
    .attr("offset", percent+'%')
    .attr("stop-color", "red")
    .attr("stop-opacity", 1);

    gradient.append("svg:stop")
    .attr("offset", "0%")
    .attr("stop-color", "gray")
    .attr("stop-opacity", 0.3);
    return "url(#gradient"+i+")";
    };
    function update_line(){
          var t = g2.transition()
          .duration(750)
//          .on("start", function repeat() {
//            d3.active(this).selectAll("path").filter(":nth-child(even)")
//                .style("stroke", "purple")
//              .transition()
//                .style("stroke", "blue")
//              .transition()
//               .on("start", repeat) ;
//          })
;

       var dim = analyze(); 
//        g2.selectAll("cirle").data([0])
//                .enter().append("circle")
//                .attr("cx",cx)
//                .attr("cy",cy)
//                .attr("r",3)
//                .attr("fill","black");
        var drawPackage = function(d,i){
            return drawLine(dim[i].x,dim[i].y,dim[i].dx,dim[i].dy);         
        }; 
        //Circles added to the circleGroup
        var lines = g2.selectAll("path")
                                 .data(package);

//          lines.remove();                      
        lines

                 .attr("d",drawPackage)

                 .attr("stroke-width","1")
                 .attr("fill","url(#gradient)")
                 .attr("opacity","0.3")

                 .attr("stroke","orange")
                 .attr("stroke-width","11");

        lines.enter().append("path")
                    .attr("d",drawPackage)
                    
                    .attr("stroke-width","1")

                    .attr("fill","none")         
                    .attr("stroke",function(d,i){return getGradient(d.keyed*100/d.volume,i);})
                    .attr("stroke-width","11")
  
	.on("load", function(){return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px").style("visibility", "visible");})
                    ;
//            var i = 0;
//            i++;
//            if (i == count) return;
//            update_line();
        }
        function analyze(){
            total_len = 0;
            ab =0;
            dimension =[];
            count = package.length;
            package.forEach(function(v){total_len += v.volume/1000;});
            count = count>6?6:count;
            for(i=0;i<count;i++){
                d={};
                d.x = cx+(i-total_len/2)*stdLen - (ab)*stdLen;
                d.y = cy+(-i+total_len/2)*stdHei;
                d.dx = cx+(i+package[i].volume/1000-total_len/2)*stdLen - (ab)*stdLen;
                d.dy = cy+(-i+total_len/2)*stdHei+0.01;
                ab += package[i].volume/1000 !== 1 ? 1 - package[i].volume/1000:0;
                dimension.push(d);
            }
            return dimension;
        }
//function update(data) {
//  var t = d3.transition()
//      .duration(750)
//      .on("start", function repeat() {
//        d3.active(this)
//            .style("background", "red")
//         // .transition()
//            //.style("background", "blue")
//          //.transition()
//            //.on("start", repeat);
//      });
//
//  // JOIN new data with old elements.
//  var text = g.selectAll("text")
//    .data(data, function(d) { return d; });
//
//  // EXIT old elements not present in new data.
//  text.exit()
//      .attr("class", "exit")
//    .transition(t)
//      .attr("y", 60)
//      .style("fill-opacity", 1e-6)
//      .remove();
//
//  // UPDATE old elements present in new data.
//  text.attr("class", "update")
//      .attr("y", 0)
//      .style("fill-opacity", 1)
//    .transition(t)
//      .attr("x", function(d, i) { return i * 32; });
//
//  // ENTER new elements present in new data.
//  text.enter().append("text")
//      .attr("class", "enter")
//      .attr("dy", ".35em")
//      .attr("y", -60)
//      .attr("x", function(d, i) { return i * 32; })
//      .style("fill-opacity", 1e-6)
//      .text(function(d) { return d; })
//    .transition(t)
//      .attr("y", 0)
//      .style("fill-opacity", 1);
//}
update();
update_line();
//
//// Grab a random sample of letters from the alphabet, in alphabetical order.
d3.interval(function() {
        data[1].value +=1;
        data[3].value +=1;
        data[5].value += data[5].value === data[4].value ? 0:1;
        data[1].percent = data[1].value/data[0].value;
        data[3].percent = data[3].value/data[2].value;
        data[5].percent = data[5].value/data[4].value>1 ? 0.999 : data[5].value/data[4].value;
        update();
//        package.push({"volume":d3.randomUniform(100,1000)(),"keyed":100});
//        update_line();
}, 1500);
// The initial display.
//
</script>
</html>
